var Texpand=Class.create();Texpand.version=0.3;Texpand.prototype={initialize:function(h,i){this.options={increment:30,onExpand:Prototype.emptyFunction};Object.extend(this.options,i||{});this.element=$(h);if(this.element.tagName.toLowerCase()!='textarea')throw('Texpand: can only be initialized with a <textarea> but got <'+this.element.tagName.toLowerCase()+'>');if(typeof Prototype=='undefined'||(parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6))throw('Texpand: requires Prototype 1.6.0+');if(typeof Effect=='undefined')throw('Textpand: requires Script.aculo.us, specifically Effects');this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'"></div>'});this.mimic=this.element.next();this.mimic.update(this.element.value);var f=this.element.getStyle('fontSize');if(f.search(/em/)>=0){var g=parseFloat(f.replace(/em/,''))*10;this.element.setStyle({fontSize:g+'px'})}var d={};var e=$w('borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing');for(var c=0,j=e.length;c<j;c++){d[e[c]]=this.element.getStyle(e[c])}this.mimic.setStyle(Object.extend(d,{display:'block',border:'1px solid #000'}));var b=this.element.getWidth();if(b!=this.mimic.getWidth()){var a;b-=isNaN(a=parseInt(this.element.getStyle('marginLeft'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('marginRight'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('borderLeftWidth'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('borderRightWidth'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('paddingLeft'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('paddingRight'),10))?0:a;b+='px';this.mimic.setStyle({width:b})}this.element.observe("keydown",this._0.bind(this));return this.element},_0:function(i){this.mimic.update(this.element.value.replace(/\n/gm,'<br />'));var f=this.mimic.getHeight();var g=this.element.getHeight();var d=g-f;var e=g+(this.options.increment-d);if(d<this.options.increment){var c=Effect.Queues.get('texpand'+this.element.identify());c.each(function(h){h.cancel()});this.element.morph('height: '+e+'px;',{duration:0.1,queue:{position:'end',scope:'texpand'+this.element.identify(),limit:2}});this.options.onExpand.call(i)}}};