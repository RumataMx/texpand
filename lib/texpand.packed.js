var Texpand=Class.create();Texpand.version=0.8;Texpand.prototype={initialize:function(b,i){this.options={increment:15,autoShrink:false,expandOnLoad:false,onExpand:Prototype.emptyFunction};Object.extend(this.options,i||{});this.element=$(b);if(this.element.tagName.toLowerCase()!='textarea'){throw(new Error('Texpand: can only be initialized with a <textarea> but got <'+this.element.tagName.toLowerCase()+'>'));}if(typeof Prototype=='undefined'||(parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)){throw(new Error('Texpand: requires Prototype 1.6.0+'));}if(typeof Effect=='undefined'){throw(new Error('Textpand: requires Script.aculo.us, specifically Effects'));}this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'"></div>'}).setStyle({resize:'none',overflow:'hidden'});this.mimic=this.element.next();this.mimic.update(this.element.value);var g=this.element.getStyle('fontSize');if(g.search(/em/)>=0){var h=parseFloat(g.replace(/em/,''))*10;this.element.setStyle({fontSize:h+'px'})}var e={};var d=$w('borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing');for(var f=0,j=d.length;f<j;f++){e[d[f]]=this.element.getStyle(d[f])}this.mimic.setStyle(Object.extend(e,{display:'block',whiteSpace:'pre-wrap',position:'absolute',left:'-9999px',top:'-9999px'}));this.element.setStyle({fontFamily:this.mimic.getStyle('fontFamily')});var c=this.element.getWidth();if(c!=this.mimic.getWidth()){var a;c-=isNaN(a=parseInt(this.element.getStyle('marginLeft'),10))?0:a;c-=isNaN(a=parseInt(this.element.getStyle('marginRight'),10))?0:a;c-=isNaN(a=parseInt(this.element.getStyle('borderLeftWidth'),10))?0:a;c-=isNaN(a=parseInt(this.element.getStyle('borderRightWidth'),10))?0:a;c-=isNaN(a=parseInt(this.element.getStyle('paddingLeft'),10))?0:a;c-=isNaN(a=parseInt(this.element.getStyle('paddingRight'),10))?0:a;c+='px';this.mimic.setStyle({width:c})}this.element.observe("keyup",this._0.bind(this));this.initialHeight=this.element.getHeight();if(this.options.expandOnLoad)this._0();return this.element},_0:function(b){if(b){clearTimeout(this.keypressDelay);this.keypressDelay=this.doExpand.bind(this).delay(0.1,b)}else this.doExpand()},doExpand:function(i){this.mimic.update(this.element.value.replace(/\n/gm,'<br />')+'<br />');var g=this.mimic.getHeight();var h=this.element.getHeight();var e=h-g;var d;if(this.element.value==='')d=this.initialHeight;else d=h+(this.options.increment-e);if((this.options.autoShrink&&(e>this.options.increment)||this.element.value==='')||e<this.options.increment){var f=Effect.Queues.get('texpand'+this.element.identify());f.each(function(b){b.cancel()});this.element.morph('height: '+d+'px;',{duration:0.05,queue:{position:'end',scope:'texpand'+this.element.identify(),limit:2}});this.options.onExpand.call(i)}},appendText:function(b){this.element.value+=b;this._0()},setValue:function(b){this.element.value=b;this._0()}};