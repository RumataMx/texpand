var Texpand=Class.create();Texpand.version=0.6;Texpand.prototype={initialize:function(c,j){this.options={increment:15,autoShrink:false,fontFamily:'inherit',onExpand:Prototype.emptyFunction};Object.extend(this.options,j||{});this.element=$(c);if(this.element.tagName.toLowerCase()!='textarea'){throw(new Error('Texpand: can only be initialized with a <textarea> but got <'+this.element.tagName.toLowerCase()+'>'));}if(typeof Prototype=='undefined'||(parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)){throw(new Error('Texpand: requires Prototype 1.6.0+'));}if(typeof Effect=='undefined'){throw(new Error('Textpand: requires Script.aculo.us, specifically Effects'));}this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'"></div>'}).setStyle({resize:'none',overflow:'hidden'});this.mimic=this.element.next();this.mimic.update(this.element.value);var g=this.element.getStyle('fontSize');if(g.search(/em/)>=0){var h=parseFloat(g.replace(/em/,''))*10;this.element.setStyle({fontSize:h+'px'})}var d={};var f=$w('borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing');for(var e=0,i=f.length;e<i;e++){d[f[e]]=this.element.getStyle(f[e])}this.mimic.setStyle(Object.extend(d,{display:'block',position:'absolute',left:'-9999px',top:'-9999px'}));this.element.setStyle({fontFamily:this.mimic.getStyle('fontFamily')});var a=this.element.getWidth();if(a!=this.mimic.getWidth()){var b;a-=isNaN(b=parseInt(this.element.getStyle('marginLeft'),10))?0:b;a-=isNaN(b=parseInt(this.element.getStyle('marginRight'),10))?0:b;a-=isNaN(b=parseInt(this.element.getStyle('borderLeftWidth'),10))?0:b;a-=isNaN(b=parseInt(this.element.getStyle('borderRightWidth'),10))?0:b;a-=isNaN(b=parseInt(this.element.getStyle('paddingLeft'),10))?0:b;a-=isNaN(b=parseInt(this.element.getStyle('paddingRight'),10))?0:b;a+='px';this.mimic.setStyle({width:a})}this.element.observe("keyup",this._0.bind(this));return this.element},_0:function(i){var a=function(j){this.mimic.update(this.element.value.replace(/\n/gm,'<br />')+'<br />');var g=this.mimic.getHeight();var h=this.element.getHeight();var d=h-g;var f=h+(this.options.increment-d);if((this.options.autoShrink&&d>this.options.increment)||d<this.options.increment){var e=Effect.Queues.get('texpand'+this.element.identify());e.each(function(c){c.cancel()});this.element.morph('height: '+f+'px;',{duration:0.05,queue:{position:'end',scope:'texpand'+this.element.identify(),limit:2}});this.options.onExpand.call(j)}}.bind(this);if(i){clearTimeout(this.keypressDelay);this.keypressDelay=a.delay(0.1,i)}else a()},appendText:function(c){this.element.value+=c;this._0()},setValue:function(c){this.element.value=c;this._0()}};