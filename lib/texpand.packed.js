var Texpand=Class.create();Texpand.version=0.3;Texpand.prototype={initialize:function(f,g){this.options={increment:30,onExpand:Prototype.emptyFunction}Object.extend(this.options,g||{});this.element=$(f);if(this.element.tagName.toLowerCase()!='textarea')throw('Texpand: can only be initialized with a <textarea> but got <'+this.element.tagName.toLowerCase()+'>');if(typeof Prototype=='undefined'||(parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6))throw('Texpand: requires Prototype 1.6.0+');if(typeof Effect=='undefined')throw('Textpand: requires Script.aculo.us, specifically Effects');this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'"></div>'});this.mimic=this.element.next();this.mimic.update(this.element.value);var d=this.element.getStyle('fontSize');if(d.search(/em/)>=0){var e=parseFloat(d.replace(/em/,''))*10;this.element.setStyle({fontSize:e+'px'})}var b={};var c=$w('borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing');for(var a=0,h=c.length;a<h;a++){b[c[a]]=this.element.getStyle(c[a])}this.mimic.setStyle(Object.extend(b,{display:'block',position:'absolute',left:'-9999px',top:'-9999px'}));this.element.observe("keydown",this._0.bind(this));return this.element},_0:function(g){this.mimic.update(this.element.value.replace(/\n/gm,'<br />'));var d=this.mimic.getHeight();var e=this.element.getHeight();var b=e-d;var c=e+(this.options.increment-b);if(b<this.options.increment){var a=Effect.Queues.get('texpand'+this.element.identify());a.each(function(f){f.cancel()});this.element.morph('height: '+c+'px;',{duration:0.1,queue:{position:'end',scope:'texpand'+this.element.identify(),limit:2}});this.options.onExpand.call(g)}}};