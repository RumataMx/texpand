var Texpand=Class.create();Texpand.version=0.9;Texpand.prototype={initialize:function(a,b){this.options={increment:5,autoShrink:false,expandOnLoad:false,expandOnFocus:true,shrinkOnBlur:true,tabSize:4,onExpand:Prototype.emptyFunction};Object.extend(this.options,b||{});this.element=$(a);if(this.element.tagName.toLowerCase()!='textarea'){throw(new Error('Texpand: can only be initialized with a <textarea> but got <'+this.element.tagName.toLowerCase()+'>'));}if(typeof Prototype=='undefined'||(parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)){throw(new Error('Texpand: requires Prototype 1.6.0+'));}if(typeof Effect=='undefined'){throw(new Error('Textpand: requires Script.aculo.us, specifically Effects'));}this.element.value=this.element.value.replace(/\t/g,' '.times(this.options.tabSize));this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'Parent"><div id="texpand-mimic-'+this.element.identify()+'">'+this.element.value+'</div></div>'}).setStyle({resize:'none',overflow:'hidden'});this.mimic=this.element.next().down();this._1();this._2();this.initialHeight=this.element.getHeight();this.element.observe("keyup",this._0.bind(this));if(this.options.expandOnFocus)this.element.observe("focus",this._0.bind(this));if(this.options.shrinkOnBlur)this.element.observe("blur",this._4.bind(this));if(this.options.expandOnLoad)this._0();return this.element},_2:function(){if(!this.elementStyles&&!this.mimicStyles){this.elementStyles={};this.mimicStyles={};var b=this.element.getStyle('fontSize');this.elementStyles.fontSize=b;if(b.search(/em/)>=0){var d=parseFloat(b.replace(/em/,''))*10;this.elementStyles.fontSize=d+'px'}var c=$w('borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing');for(var f=0,i=c.length;f<i;f++){this.mimicStyles[c[f]]=this.element.getStyle(c[f])}this.mimicStyles.display='block';this.mimicStyles.position='absolute';this.mimicStyles.left='-9999px';this.mimicStyles.top='-9999px';var g=this.element.getWidth();if(g!=this.mimic.getWidth()){var h;$w('marginLeft marginRight borderLeftWidth borderRightWidth paddingLeft paddingRight').each(function(a){g-=isNaN(h=parseInt(this.element.getStyle(a),10))?0:h}.bind(this));g+='px';this.mimicStyles.width=g}}this.mimic.setStyle(this.mimicStyles);this.element.setStyle(this.elementStyles);this.element.setStyle({fontFamily:this.mimic.getStyle('fontFamily')})},_1:function(){if(!this.whiteSpaceChecked){var b=$w('pre-wrap -moz-pre-wrap -pre-wrap -o-pre-wrap pre');var d;b.each(function(a){try{this.mimic.setStyle({'whiteSpace':a});if(this.mimic.getStyle('whiteSpace')!=a)throw'error';}catch(e){return}d=a;throw $break;}.bind(this));if(d=='pre')this.wsHack=true;else{this.wsHack=this._5()}this.whiteSpaceChecked=true}if(this.mimic.innerHTML==this.element.value)return;if(this.wsHack){var c=this.mimic.up();c.update('<pre id="texpand-mimic-'+this.element.identify()+'">'+this.element.value+'<br /></pre>');this.mimic=c.down();this._2();this.mimic.setStyle({wordWrap:'break-word'})}else{this.mimic.update(this.element.value+'<br />')}},_5:function(){var a='a \n'.times(10);this.mimic.update(a);return this.mimic.getHeight()===0||!this.mimic.innerHTML.include('\n')},_3:function(b){var d=Effect.Queues.get('texpand'+this.element.identify());d.each(function(a){a.cancel()});this.element.morph('height: '+b+'px;',{duration:0.05,queue:{position:'end',scope:'texpand'+this.element.identify(),limit:2}})},_4:function(a){this._3(this.initialHeight)},_0:function(a){if(a){clearTimeout(this.keypressDelay);this.keypressDelay=this.doExpand.bind(this).delay(0.1,a)}else this.doExpand()},doExpand:function(a){this._1();var b=this.mimic.getHeight();var d=this.element.getHeight();var c=d-b;var f;if(this.element.value==='')f=this.initialHeight;else f=d+(this.options.increment-c);if((this.options.autoShrink&&(c>this.options.increment)||this.element.value==='')||c<this.options.increment){this._3(f);this.options.onExpand.call(a)}},appendText:function(a){this.element.value+=a;this._0()},setValue:function(a){this.element.value=a;this._0()}};