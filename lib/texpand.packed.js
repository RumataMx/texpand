var Texpand=Class.create();Texpand.version=0.6;Texpand.prototype={initialize:function(c,i){this.options={increment:15,onExpand:Prototype.emptyFunction};Object.extend(this.options,i||{});this.element=$(c);if(this.element.tagName.toLowerCase()!='textarea'){throw('Texpand: can only be initialized with a <textarea> but got <'+this.element.tagName.toLowerCase()+'>');}if(typeof Prototype=='undefined'||(parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)){throw('Texpand: requires Prototype 1.6.0+');}if(typeof Effect=='undefined'){throw('Textpand: requires Script.aculo.us, specifically Effects');}this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'"></div>'}).setStyle({resize:'none',overflow:'hidden'});this.mimic=this.element.next();this.mimic.update(this.element.value);var g=this.element.getStyle('fontSize');if(g.search(/em/)>=0){var h=parseFloat(g.replace(/em/,''))*10;this.element.setStyle({fontSize:h+'px'})}var e={};var f=$w('borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing');for(var d=0,j=f.length;d<j;d++){e[f[d]]=this.element.getStyle(f[d])}this.mimic.setStyle(Object.extend(e,{display:'block',position:'absolute',left:'-9999px',top:'-9999px'}));this.element.setStyle({fontFamily:this.mimic.getStyle('fontFamily')});var b=this.element.getWidth();if(b!=this.mimic.getWidth()){var a;b-=isNaN(a=parseInt(this.element.getStyle('marginLeft'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('marginRight'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('borderLeftWidth'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('borderRightWidth'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('paddingLeft'),10))?0:a;b-=isNaN(a=parseInt(this.element.getStyle('paddingRight'),10))?0:a;b+='px';this.mimic.setStyle({width:b})}this.element.observe("keyup",this._0.bind(this));return this.element},_0:function(i){this.mimic.update(this.element.value.replace(/\n/gm,'<br />')+'<br />');var g=this.mimic.getHeight();var h=this.element.getHeight();var e=h-g;var f=h+(this.options.increment-e);if(e<this.options.increment){var d=Effect.Queues.get('texpand'+this.element.identify());d.each(function(c){c.cancel()});this.element.morph('height: '+f+'px;',{duration:0.05,queue:{position:'end',scope:'texpand'+this.element.identify(),limit:2}});this.options.onExpand.call(i)}},appendText:function(c){this.element.value+=c;this._0()},setValue:function(c){this.element.value=c;this._0()}};